# Очереди
А нахуя? А вот так вот!
Короч брокеры сообщений могт работать как файр енд форгет,
ты вкинул сообщение и тебе пофиг, как конкретно и кем это будет обработано.
Главное, что будет. Оно асинхронно, оно масштабируемо, оно умеет балансировать всю фигню внутри себя.
Помимо прочего, можно организовать полноценное общение внутри системы типа запрос-ответ.

# HTTP 2.0

https://habr.com/ru/articles/308846/

# Kafka

https://habr.com/ru/companies/southbridge/articles/550934/

# RABBIT_MQ
## дисклеймер: в основном тут чисто мой джуновый опыт + немного беглой гуглёжки. Дай бох на 10 минут материала хватит (that was she said). Во многом этот материал готовился ради моего личного саморазвития, иметь мотивацию собрать мысли в кучу.
будет кратко и по верхам (притворюсь статьёй на хабре с нулевым рейтингом)
* что такое очередь человеку из РФ нет смысла объяснять, но попробую
  Очередь в том смысле, когда мы говорим о ней в бекенде - система упорядоченной доставки сообщений.  Подробнее о раббите:
* Раббит реализует протокол AMQP
  протокол содержит в себе понятия:
  сообщение - цельный детерменированный кусок данных + заголовки
  очередь - по факту как раз хранилище сообщений. Из названия понятно, что сообщения там упорядочены первый вошёл -> первый вышел
  ексчейндж - точка обмена. Абстрактный мужик с почты, который понимает, в какую очередь отправить сообщение. Понимает это по роутинг ключу, приложенному к сообщению. Бывают вот такие:
  — fanout - закидывает во все очереди, что он знает
  — direct - закидывает в одну конкретную очередь, название которой совпадает со значением ключа
  — topic - похоже на то, что выше: ключ теперь не имя очереди, а её маска. Сообщение будет закинуто во все известные для ексчейнджа очереди, которые подходят под маску
  — header (in rabbit) - как топик, но основывается уже не на ключе, а на хедерах, а режим совпадения определяется (не юзал ни разу, если честно, сыплю голову пеплом)


Как это всё работает? У нас есть два участника: отправитель, доставщик (сам раббит) и получатель. Когда отправитель отправляет отправленное отправление (вырезать это нахуй) когда отправитель шлёт сообщение, его получает ексчейндж на стороне доставщика. Ексчейндж по переданным с сообщениям параметрам (роутинг ключ или заголовки, как описано выше) решает, в какую очередь пихнуть сообщение. На другой стороне стоит получатель (а то и несколько), который смотрит на конкретную очередь и если в неё что-то упало он это сообщение получает и обрабатывает на своё усмотрение. Если получателей несколько в одну очередь, они будут получать сообщения по очереди по кругу

Управление сообщениями:
каждое сообщение имеет delivery tag,  монотонно возрастающий в рамках каждого канала (канал это что-то типа подконнекта в рамках одного  TCP-соединения), на подобии того, как это работает в Кафке. Таким макаром каждое сообщение имеет свой ID в рамках канала.
Нафига?
Каждое сообщение в раббите должно быть подтверждено (насчёт каждого не уверен, но выглядит так), это его финальный статус. Это может произойти автоматически (как только сообщение упадёт в TCP между очередью и получателем), если ты офигенно уверен в себе, либо подтверждено вручную. Есть три метода ручного подтверждения:
— ack (тип от слова acknowlegement) - это когда всё ок, сообщение доставлено и успешно обработано. Хе-хе.
— nack - это когда обработка сообщения где-то померла в процессе. Не хе-хе.
— reject - то же самое, что и nack, но не умеет в батчи (о них не буду рассказывать, лень, да и не знаю нихрена)
Таким макаром, если настроено ручное подтверждение, получатель ловит сообщение из очереди, делает свои грязные дела и после этого шлёт ack или nack, прикладывая delivery tag, дабы rabbit понял, что конкретно ты там подтвердил вообще.
В любом случае при ack или nack сообщения будут выпилены из очереди с чистой совестью и помечены как доставленные. НО: в случае nack сообщение может быть закинуто раббитом оратно в ту же очередь и даже примерно в то же место, либо отправлено в очередь к дохлым сообщениям (имя очереди описано в конфигах очереди)

Собственно, на этом жизненный цикл сообщения завершён. Мой краткий рассказ тоже. Если ещё есть время - дополнить от балды работу со спрингом.
